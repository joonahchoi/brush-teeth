<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ì–‘ì¹˜ ì¸ì¦ ì•±</title>
  <style>
    :root{
      --APP-W: 1080px;
      --APP-H: 1418px;
      --bg1: #74b9ff;
      --bg2: #0984e3;
      --ink: #2d3436;
      --sub: #636e72;
      --ok1: #00b894;
      --ok2: #00a085;
      --acc: #fd79a8;
    }
    /* í™”ë©´ ì¤‘ì•™ ì •ë ¬ + ë°°ê²½ */
    html, body {
      height: 100%;
      margin: 0;
      background: linear-gradient(135deg, var(--bg1), var(--bg2));
      overflow: hidden; /* ë°”ê¹¥ ìŠ¤í¬ë¡¤ ë°©ì§€ */
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    /* ìŠ¤ì¼€ì¼ ë˜í¼: ì–´ë–¤ í™”ë©´ì—ì„œë„ ë¹„ìœ¨ ìœ ì§€ */
    .stage {
      width: 100vw;
      height: 100vh;
      display: grid;
      place-items: center;
    }
    /* ì‹¤ì œ ì•± ìº”ë²„ìŠ¤: 1080 x 1418 ê³ ì • */
    #app {
      width: var(--APP-W);
      height: var(--APP-H);
      background: white;
      border-radius: 24px;
      box-shadow: 0 24px 50px rgba(0,0,0,0.15);
      overflow: hidden; /* ë‚´ë¶€ì—ì„œë§Œ ìŠ¤í¬ë¡¤ ê´€ë¦¬ */
      position: relative;
      transform-origin: top left; /* JS ìŠ¤ì¼€ì¼ ê¸°ì¤€ì  */
    }

    /* ë‚´ë¶€ ë ˆì´ì•„ì›ƒ */
    .container {
      height: 100%;
      display: flex;
      flex-direction: column;
      padding: 40px 48px;
    }

    .header { margin-bottom: 28px; text-align: center; }
    .header h1 { color: var(--ink); font-size: 40px; margin: 6px 0 6px; }
    .header .emoji { font-size: 64px; display: block; }
    .header p { color: var(--ink); opacity: .85; }

    .form-group { margin-bottom: 20px; }
    .form-label { display:block; margin-bottom:10px; color:var(--ink); font-weight:700; font-size:18px; }
    select, input[type="text"]{
      width: 100%;
      padding: 14px 16px;
      border: 2px solid #e6e8ec;
      border-radius: 12px;
      font-size: 18px;
      outline: none;
      transition: border-color .25s ease;
      background: #fff;
    }
    select:focus, input[type="text"]:focus { border-color: var(--bg1); }

    .inline-row { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }

    .helper {
      margin-top: 6px; font-size: 14px; color: var(--ink);
      background:#eaf4ff; padding: 12px 14px; border-radius: 10px;
      line-height: 1.4;
    }

    .btn {
      display: inline-flex; align-items: center; justify-content: center;
      background: linear-gradient(135deg, var(--ok1), var(--ok2));
      color: #fff; border: none; padding: 16px 24px;
      border-radius: 999px; font-size: 18px; font-weight: 800;
      cursor: pointer; transition: transform .2s, box-shadow .2s;
      width: 100%;
    }
    .btn:hover { transform: translateY(-2px); box-shadow:0 12px 24px rgba(0,184,148,.25); }
    .btn:disabled { background:#d6d8db; cursor:not-allowed; transform:none; box-shadow:none; }
    .btn-secondary { background:#636e72; }
    .btn-pink { background: var(--acc); }
    .btn-pink:hover { background:#e84393; }

    .camera-container { display:none; flex-direction:column; gap: 18px; }

    .student-info {
      background:#f7f9fb; padding:16px 18px; border-radius:12px; display:none;
    }
    .student-info h3 { margin:0 0 6px; color:var(--ink); font-size: 22px; }
    .timestamp { margin:0; color:var(--sub); font-size:16px; }

    .camera-placeholder {
      width: 100%;
      max-width: 520px;
      height: 380px;
      margin: 0 auto;
      background:#f8f9fa;
      border: 3px dashed var(--bg1);
      border-radius: 16px;
      display:flex; align-items:center; justify-content:center; flex-direction:column;
      color: var(--sub); text-align: center; padding: 16px;
    }

    .success-message {
      display:none; background:var(--ok1); color:#fff; padding:16px; border-radius:12px;
      animation:fadeIn .4s ease-in;
    }
    @keyframes fadeIn { from {opacity:0; transform:translateY(6px);} to {opacity:1; transform:translateY(0);} }

    .records-section {
      margin-top: 16px; padding-top: 18px; border-top: 2px solid #f1f2f6;
      display:none;
    }
    .records-list {
      /* ê³ ì • í™”ë©´ ì•ˆì—ì„œë§Œ ìŠ¤í¬ë¡¤ë˜ë„ë¡ ë†’ì´ í™•ë³´ */
      max-height: 360px;
      overflow-y: auto;
      background:#f7f9fb; border-radius:12px; padding:10px; margin-top:10px;
    }
    .record-item {
      padding:10px 12px; background:#fff; border-radius:10px; margin-bottom:8px;
      display:flex; justify-content:space-between; align-items:center; font-size:16px;
    }
    .badge {
      display:inline-block; padding:2px 8px; border-radius:999px; font-size:12px; font-weight:800;
      background:#ffeaa7; color:#5c6b70; margin-left:6px;
    }
    .badge-green { background:#55efc4; color:#005d49; }

    /* ë‚´ë¶€ ì„¹ì…˜ ê°„ê²© íŠœë‹ */
    .section { margin-bottom: 14px; }
    .spacer { height: 8px; }

  </style>
</head>
<body>
  <div class="stage">
    <div id="app">
      <div class="container">
        <div class="header section">
          <span class="emoji">ğŸ¦·</span>
          <h1>ì–‘ì¹˜ ì¸ì¦ ì•±</h1>
          <p>ì ì‹¬ì‹œê°„ ì–‘ì¹˜ ì²´í¬!</p>
        </div>

        <!-- ë“±ë¡ í¼ -->
        <div id="registration-form" class="section">
          <div class="inline-row">
            <div class="form-group">
              <label class="form-label" for="grade">í•™ë…„ ì„ íƒ</label>
              <select id="grade" aria-label="í•™ë…„ ì„ íƒ">
                <option value="">í•™ë…„ì„ ì„ íƒí•˜ì„¸ìš”</option>
                <option value="1">1í•™ë…„</option>
                <option value="2">2í•™ë…„</option>
                <option value="3">3í•™ë…„</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label" for="class">ë°˜ ì„ íƒ</label>
              <select id="class" aria-label="ë°˜ ì„ íƒ">
                <option value="">ë°˜ì„ ì„ íƒí•˜ì„¸ìš”</option>
                <option value="1">1ë°˜</option>
                <option value="2">2ë°˜</option>
                <option value="3">3ë°˜</option>
                <option value="4">4ë°˜</option>
                <option value="5">5ë°˜</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label" for="name">ì´ë¦„ ì„ íƒ</label>
            <select id="name" aria-label="ì´ë¦„ ì„ íƒ">
              <option value="">ì´ë¦„ì„ ì„ íƒí•˜ì„¸ìš”</option>
            </select>
          </div>

          <div class="helper">
            â€¢ ë“±ë¡ í›„ <strong>AR í•„í„°</strong>ëŠ” ìƒˆ íƒ­ìœ¼ë¡œ ì—´ë¦½ë‹ˆë‹¤. ì´¬ì˜ í›„ ì´ í˜ì´ì§€ë¡œ ëŒì•„ì™€ <em>ì–‘ì¹˜ ì¸ì¦ ì™„ë£Œ</em>ë¥¼ ëˆŒëŸ¬ ì£¼ì„¸ìš”.<br/>
            â€¢ ì ì‹¬ì‹œê°„(ê¸°ë³¸ 11:30â€“13:30) ì™¸ì—ëŠ” ê²½ê³ ê°€ í‘œì‹œë©ë‹ˆë‹¤.
          </div>

          <div class="spacer"></div>
          <button class="btn" id="register-btn">ë“±ë¡í•˜ê¸°</button>
        </div>

        <!-- ì¹´ë©”ë¼ ì•ˆë‚´/ë²„íŠ¼ -->
        <div class="camera-container section" id="camera-section" aria-live="polite">
          <div class="student-info" id="student-info">
            <h3 id="student-display"></h3>
            <p class="timestamp" id="current-time"></p>
          </div>

          <div class="camera-placeholder">
            <div id="camera-placeholder-content">
              <div style="font-size:56px;">ğŸ“¸</div>
              <p style="margin-top:8px;">AR í•„í„° í˜ì´ì§€ëŠ” ë³´ì•ˆ ì •ì±…ìœ¼ë¡œ</p>
              <p>ì´ í˜ì´ì§€ ì•ˆì— ì§ì ‘ í‘œì‹œí•  ìˆ˜ ì—†ì–´ìš”.</p>
              <button class="btn" id="open-ar-btn" style="margin-top:12px;">AR í•„í„° ì—´ê¸°</button>
              <p style="font-size:14px;margin-top:8px; line-height:1.4;">
                ì´¬ì˜ í›„ ì´ íƒ­ìœ¼ë¡œ ëŒì•„ì™€ ì•„ë˜ì˜ <strong>ì–‘ì¹˜ ì¸ì¦ ì™„ë£Œ!</strong>ë¥¼ ëˆŒëŸ¬ ê¸°ë¡í•˜ì„¸ìš”.
              </p>
            </div>
          </div>

          <button class="btn" id="complete-btn">ì–‘ì¹˜ ì¸ì¦ ì™„ë£Œ!</button>
          <button class="btn btn-secondary" id="back-btn">ëŒì•„ê°€ê¸°</button>

          <div class="success-message" id="success-message">
            <h3 style="margin:0 0 6px;">ğŸ‰ ì–‘ì¹˜ ì¸ì¦ ì™„ë£Œ!</h3>
            <p style="margin:0;">ê±´ê°•í•œ ì¹˜ì•„ë¥¼ ìœ„í•´ ë…¸ë ¥í•˜ëŠ” ë‹¹ì‹ ì´ ë©‹ì ¸ìš”!</p>
          </div>
        </div>

        <!-- ê¸°ë¡ ì„¹ì…˜ -->
        <div class="records-section section" id="records-section">
          <h3 style="margin:0;">ì˜¤ëŠ˜ì˜ ì–‘ì¹˜ ê¸°ë¡</h3>
          <div class="records-list" id="records-list"></div>
          <div class="spacer"></div>
          <button class="btn btn-pink" id="export-btn">ì—‘ì…€ë¡œ ë‚´ë³´ë‚´ê¸°</button>
        </div>

        <!-- í•˜ë‹¨ ì—¬ë°± ë³´ì • -->
        <div style="flex:1 1 auto;"></div>
      </div>
    </div>
  </div>

  <script>
  // ===== í™”ë©´ ìŠ¤ì¼€ì¼(1080x1418 ê³ ì • ìº”ë²„ìŠ¤) =====
  function fitToScreen() {
    const app = document.getElementById('app');
    const W = 1080, H = 1418;
    const scale = Math.min(window.innerWidth / W, window.innerHeight / H);
    app.style.transform = `scale(${scale})`;
  }
  window.addEventListener('load', fitToScreen);
  window.addEventListener('resize', fitToScreen);

  // ===== ì„¤ì •ê°’(ì ì‹¬ì‹œê°„) =====
  const LUNCH_START = { hour: 11, minute: 30 };
  const LUNCH_END   = { hour: 13, minute: 30 };

  // ===== í•™ìƒ ëª…ë ¬í‘œ =====
  const studentList = {
    // 1í•™ë…„
    "1-1": ["ê°•íƒœìœ ","ê¹€ê°•ìœ¨","ê¹€ê°•í˜„","ê¹€ë¯¼ì¤€","ê¹€ë¯¼í˜¸","ê¹€ë²”ì„œ","ê¹€ì¢…í˜„","ê¹€ì§€ì„­","ê¹€íƒœí˜„","ë…¸ìœ í•˜","ë°•ì„œì§„","ë°•ì„í™˜","ë°•í˜„ë¹ˆ","ì†¡ì§€í›„","ì˜¥ì±„ìš´","ì´ê·œë¹ˆ","ì´ê¸°ì¤€","ì´ìœ¤ê±´","ì´ì¸ì„±","ì´ì¬í˜„","ì´í›„í˜„","ì„ë¼ì›","ì„ìŠ¹ìœ ","ì „ìŠ¹ë¯¼","ì •êµìš´","ì¡°ìš©ìš°","ì¡°í•˜ë‘","í•œìŠ¹ë¹ˆ","í™©ì§€í›„"],
    "1-2": ["ê³ ê¸°í›ˆ","ê¹€ê±´ìš°","ê¹€ëŒ€ê±´","ê¹€ë¯¼ì°¬","ê¹€ì„œí™˜","ê¹€ìŠ¹ë¯¼","ê¹€ì§€í›ˆ","ê¹€í˜•ì§„","ë‚¨ë„í˜„","ë™ì§„í˜¸","ë°•ë¯¼ì¬","ë°•ì„ ìš°","ë°•íƒœì„±","ë°©ìˆ˜í™˜","ë°°ì¤€ì˜","ì†Œì •ìš°","ì†¡ì¬ì—°","ì†¡í•´ì¤€","ì˜¤ì¤€ì„","ìœ ë„ê·œ","ì´ê°•í˜¸","ì´ì‚­","ì´ìœ ì¤€","ì„ì„±ì¤€","ì „ì™„ì˜","ì •ëª…ê¸°","ì¡°í˜„ì¤€","í•˜ì¤€ìš°","í•œì¸ìš°","í™©ì¬ìš±"],
    "1-3": ["ê³ í˜„ì„±","ê³½íƒœì˜¤","ê¹€ë„ì›","ê¹€ì„±ê·œ","ê¹€ì„±íƒ","ê¹€ì€í˜¸","ê¹€ì§„ìš±","ë‚˜ì„ë¯¼","ë°•ë„í˜„","ë°•ì„±ìœ¤","ë°•ì¤€ìš©","ë°©ì§€í›ˆ","ì„±ë¯¼ê¸°","ì‹ ìœ ë¡œ","ì–‘ì§€ì›…","ì—„ìš©ì¤€","ì›ì—°í˜¸","ìœ¤íƒœì›…","ì´ìŠ¹ì—½","ì´ì˜ˆì°¬","ì´ì •ë¦¼","ì´íƒœí˜","ì „ë¯¼ì°¬","ì •ì„¸í›ˆ","ì¡°ë²”ì¤€","ì±„ë¯¼ìš°","íƒë™í˜„","í•œìŠ¹í˜¸","í•œì •ìš°","í™©ìœ¤ì„±"],
    "1-4": ["ê³µë²”ì¤€","ê¶Œìš°ì§„","ê¹€ë„í›ˆ","ê¹€ì€ìš°","ê¹€ì°¬í˜„","ê¹€í•œì¤€","ë¥˜ì§€í›ˆ","ëª¨í˜„ì„±","ë¯¼ë™íœ˜","ë°•ìŠ¹í˜","ë°•ìš©ì¤€","ë°°ì„±í˜¸","ë´‰ê±´ë‘","ì‹ ìœ¨","ì•ˆìœ ì°¬","ìœ¤ì¤€ìƒ","ìœ¤íƒœìš±","ì´ì˜ˆì¤€","ì´ì¤€","ì´ì§€í•œ","ì´í•˜ëŒ","ì„ì£¼ì›","ì¥ë¯¼ì„±","ì¥ì€ìˆ˜","ì •ì¬ì›","ì¡°ë¯¼ê·œ","ì±„ë¯¼ì¤€","ìµœì¢…ìœ¤","í•œì§€ìš©","í—ˆì¤€í˜"],
    "1-5": ["ê³½ì„ ìš°","ê¹€ë™í•˜","ê¹€ë¯¼ì„±","ê¹€ë¯¼ì¤€","ê¹€ì‹œí›„","ê¹€íƒœí˜„","ë‚¨í›ˆí¬","ë¬¸ì§„ìš°","ë¬¸í˜„ë¹ˆ","ë°•ì¬í˜„","ë°•ì¤€ë²”","ë°•í˜„ì„","ë°±ì„œìš°","ì•ˆì£¼ìƒ","ìœ ì¤€ì„œ","ìœ¤ì¤€ì˜","ìœ¤ì§„ê·œ","ì´ìƒìš´","ì´ìŠ¹ìœ ","ì´ì˜ì¤€","ì´ì¤€ì—½","ì´ì§€ì•ˆ","ì¥ë™ìš°","ì •ì •ìœ¤","ì •í˜„ìš°","ì¡°ìŠ¹ë¯¼","ìµœìš°í˜„","ìµœì¬ì˜","í—ˆë™í˜","í—ˆì‹ ìš°"],
    // 2í•™ë…„
    "2-1": ["ê°•ì„œì¤€","ê³½ìˆ˜ë¯¼","ê¹€ë‚˜ìš¸","ê¹€ë¡œìš´","ê¹€ìƒìœ¨","ê¹€ì„ ìš°","ê¹€ìœ¤ì°¬","ê¹€íƒœì–‘","ë§ˆê²½ì§„","ë¬¸ì°¬ì›","ë°•ë™í›„","ë°•ë¯¼ìš°","ë°°ì„ì›","ë°°ì‹œìš°","ì†¡í•´ì„±","ì•ˆìœ ì¤€","ì˜¤ì£¼í™˜","ìœ¤ì—¬ì„œ","ìœ¤ì˜ˆì¤€","ì´ê²½ë¯¼","ì´ë¯¼ì¤€","ì´ì€í˜¸","ì´ì¤€í˜","ì •íš¨ìœ ","ì¡°ì—°ìš°","ì¡°ìš°í˜•","ìµœëª…ì¤€","ìµœë¯¼ì¤€","ìµœìŠ¹í˜„","ì´ì°¬ìˆ˜"],
    "2-2": ["ê¹€ë‹¤ì˜¨","ê¹€ë¯¼ì¤€","ê¹€ë¯¼ì°¬","ê¹€ì§„í•˜","ê¹€íƒœí›ˆ","ê¹€í•˜ì„±","ë¬¸ì¤€ì˜","ë°•ìˆœí˜¸","ë°•ìœ¤ìŠ¹","ë°•ì€í‰","ë°•ì¸ì„œ","ë°•ì •í›„","ì†¡ê¸ˆì„±","ì‹ ë™í˜„","ì‹ ì •í˜¸","ì—¼ìŠ¹ë¹ˆ","ìœ ì§€í˜¸","ì´êµì¤€","ì´ìŠ¹í˜„","ì´ì •ë¯¼","ì´íƒœë¯¼","ì„ê±´í˜•","ì„ë™ê±´","ì„ì§€í›„","ì„í˜¸ì˜","ì •ì˜ë¡œ","ì •ì°¬ì˜","ì£¼ì„í˜„","í•œí˜„ì„"],
    "2-3": ["ê°•ëŒ€í˜„","êµ¬ì •ìœ¤","ê¹€ê·œë¯¼","ê¹€ë„í˜„","ê¹€ë™ê·œ","ê¹€ë¯¼ì¤€","ê¹€ì´ë„","ê¹€íƒœí›ˆ","ë°•ì •ì—°","ë°•ì •í˜¸","ë°•ì£¼í˜„","ì„œë™í›ˆ","ì‹ ì£¼í™˜","ì‹¬ì¬í¬","ì•ˆë¯¼ìš°","ì—„ìƒì¤€","ì—¼ìŠ¹í˜¸","ì˜¤ìœ¤íƒ","ì˜¤ì¤€íƒ","ìš©íƒœìœ¤","ìœ ì§€í˜¸","ì´ê°•","ì´ì„œìœ¤","ì´ì„í˜„","ì´ì¬ìŠ¹","ì´í˜„ì„","ì „ë„ì§„","ìµœì„ ìš°","ìµœì¬ë¯¼","í•œìœ¤ì œ"],
    "2-4": ["ê°•í˜„ìš°","êµ¬ë¯¼í˜","ê¹€ê±´í¬","ê¹€ë‚¨ìš°","ê¹€ë¯¼ì¤€","ê¹€ì´ì‚­","ê¹€í˜„ì„±","ë…¸ì—°í˜¸","ë°•ê±´ìš°","ë°•ì˜ˆì°¬","ë°±ìŠ¹ë¯¼","ì†¡ì‹œí›ˆ","ì•ˆì§€ë¯¼","ì˜¤ê±´ìš°","ìš©ì°¬ì¤‘","ìœ ì¤€ì„œ","ìœ¤ìƒí˜¸","ì´ìŠ¹ìš°","ì´ì£¼ì›","ì´ì£¼í˜„","ì´í˜„ë¹„","ì´í¬ìš°","ì„ì„±ì§„","ì¥ì€í˜","ì¥ì •ìš°","ì •ìš°ì§„","ì •í•˜ì¤€","ì¡°í˜„ìš±","ì°¨ê·œí˜¸","í™ì¤€í˜¸"],
    // 3í•™ë…„
    "3-1": ["ê³ ê·œì˜","ê¶Œë„í˜„","ê¹€ê±´ë¯¼","ê¹€ë„ìœ¤","ê¹€ì˜ˆì†¡","ê¹€ì¤€ì—½","ê¹€ì§„ìš°","ê¹€ì§„í˜¸","ê¹€í•˜ì¤€","ëª…ê¸¸ë¯¼","ëª¨ì§€ì„±","ë°•ì£¼ì›","ë°•íƒœí˜„","ë°•íš¨ë¯¼","ì†Œì¬ì›","ì†¡ìœ ê±´","ì´ë™í›ˆ","ì´ë¯¼í˜¸","ì´ìœ¤ì„œ","ì´ì¤€ì˜","ì´í˜„ì„±","ì´íš¨ì¤€","ì„ì„¸ì§„","ì¥ì² ì§„","ì „ì„±ìœ¤","ì •í•˜ì§„","ìµœê±´í˜¸","ì¶”ì„±ë³´"],
    "3-2": ["ê°•ê²½ë•","ê°•ì‹ ìš°","ê°•ì§€ì›","ê³ ëŒ€ì˜","ê¸¸í•˜ì§„","ê¹€ë„í˜„","ê¹€ë™í˜„","ê¹€ë¯¼ì¤€","ê¹€ë¯¼ì°¬","ê¹€ì„±ë¯¼","ê¹€ì§€í•œ","ë°•ë¯¼í˜•","ì„œì¤€ì„œ","ì„ í›„ì„±","ì‹¬ì„ì§€","ì‹¬ì§€í›„","ìš°ì§„","ì´ê°•í—Œ","ì´ë²”ì¤€","ì´íƒœê±´","ì„ì€ì„œ","ì¥ê±´","ì „ì§€í˜¸","ì •ë™ê·œ","ì •ì§€í˜¸","í•œì¸ìˆ˜","í™©í˜„ì„œ"],
    "3-3": ["ê°•ì¤€í˜„","ê°•í˜¸ì—°","ê°•íš¨ì¤€","ê¹€ì˜ìš±","ê¹€ìš°ì°¬","ê¹€ì œê²¸","ê¹€ì§€ìš°","ê¹€ì°¬ì„­","ê¹€íƒœí›ˆ","ê¹€í˜„í¬","ë°•ì¤€ìš°","ë°•ì§€ë¯¼","ì„œì§€í˜¸","ì‹ ìš°ì² ","ì–‘í˜„ì¤€","ìœ íƒœì™„","ì´ê±´í˜¸","ì´ì§€í™˜","ì´ì°¬ë¯¼","ì„í•œ","ì¥í˜„ëª…","ì¡°ì¤€ì˜","ìµœì˜ˆì¤€","ìµœìš°ìœ¤","ìµœì¥í˜","í•œë˜ì›","í•¨ë„ìœ¤"],
    "3-4": ["ê°•í˜„ìš°","ê³„ì¤€í˜•","ê¹€ë¯¼ì„","ê¹€ìƒí˜„","ê¹€íƒœë‘","ê¹€íƒœìœ¤","ê¹€í˜„ì¤€","ê¹€í˜•ê· ","ë‚¨ìˆ˜í˜¸","ë¥˜ì§€í˜¸","ë¬¸ì„¸ë„","ë°•ë™ë¯¼","ë°•ì‹œë°±","ì†ê²½ë¹ˆ","ì´ê°•í˜„","ì´ê²½ì¤€","ì´ì¬ìœ¤","ì´ì¤€ë¯¼","ì¡°ê°€ì˜¨","ì¡°ë¯¼í˜•","ì¡°ì„±ë¹ˆ","ì§„ì¤€ì„","ì°¨ì§€í—Œ","ì°¨í˜„ì„±","ìµœì§€ëª…","í•œìŠ¹ìš°","í•¨ìƒì›"],
    "3-5": ["ê°•ë¬¸ê·œ","ê¹€ë‹¨ìš°","ê¹€ë¯¼ì°¬","ê¹€ì‹œìš°","ê¹€ì¢…í˜¸","ë°•ê±´","ë°•ë˜ì›","ë°•ì„œì¤€","ë°•ì„±ì§„","ë°•ì‹œìš°","ë°°í˜„ì„œ","ì†¡ë„ë¹ˆ","ì˜¤ë¯¼ì¬","ìœ ì—°ì§„","ì´ê·œì—°","ì´ì„±í¬","ì´ì¤€ì„±","ì´ì§€í›„","ì¥ì€ì°¬","ì „ìŠ¹ê· ","ì •í¬ë²”","ì¡°ìœ¤ë¯¼","ì±„ì£¼ì›","ìµœì •ìš°","í•˜ë¥œì¬","í•œìµœí•´ê¸´","í™©ì§€ì„±"]
  };

  // ===== ìƒíƒœ =====
  let currentStudent = null;
  let brushingRecords = JSON.parse(localStorage.getItem('brushingRecords') || '[]');

  // ===== (ADD) ì‹œíŠ¸2 ì›¹í›… ì„¤ì • & ì „ì†¡ í•¨ìˆ˜ =====
  const SHEETS_WEBHOOK = 'https://script.google.com/macros/s/AKfycbxh5DZUyTk0Yw1uZXruj7ViUh08FO2vQogfIrLNpOQjm56R8ARL5D1kon9tXTLGsnKEjw/exec'

  async function sendToSheet2(payload) {
    try {
      // preflight(OPTIONS) í”¼í•˜ë ¤ê³  text/plainìœ¼ë¡œ ì „ì†¡
      await fetch(SHEETS_WEBHOOK, {
        method: 'POST',
        headers: { 'Content-Type': 'text/plain;charset=UTF-8' },
        body: JSON.stringify(payload)
      });
    } catch (e) {
      console.error('ì‹œíŠ¸ ì „ì†¡ ì‹¤íŒ¨', e);
    }
  }

  // ===== ìœ í‹¸ =====
  function isWithinLunch(now = new Date()) {
    const h = now.getHours();
    const m = now.getMinutes();
    const start = LUNCH_START.hour * 60 + LUNCH_START.minute;
    const end   = LUNCH_END.hour   * 60 + LUNCH_END.minute;
    const cur   = h * 60 + m;
    return cur >= start && cur <= end;
  }
  function saveRecords() {
    localStorage.setItem('brushingRecords', JSON.stringify(brushingRecords));
  }
  function updateCurrentTime() {
    const now = new Date();
    const timeString = now.toLocaleString('ko-KR', {
      year:'numeric', month:'2-digit', day:'2-digit', hour:'2-digit', minute:'2-digit'
    });
    const lunchFlag = isWithinLunch(now) ? 'ğŸ½ï¸ ì ì‹¬ì‹œê°„' : 'â° ì ì‹¬ì‹œê°„ ì™¸';
    document.getElementById('current-time').textContent = `${lunchFlag} - ${timeString}`;
  }
  function updateRecordsList() {
    const recordsList = document.getElementById('records-list');
    const today = new Date().toLocaleDateString('ko-KR');
    const todayRecords = brushingRecords.filter(r => r.date === today);

    if (todayRecords.length === 0) {
      recordsList.innerHTML = '<p style="text-align:center;color:#636e72;">ì˜¤ëŠ˜ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
      return;
    }
    recordsList.innerHTML = todayRecords.map(r => `
      <div class="record-item">
        <span>
          ${r.grade}í•™ë…„ ${r.class}ë°˜ ${r.name}
          ${r.lunchWindow === 'Y'
            ? '<span class="badge badge-green">ì ì‹¬</span>'
            : '<span class="badge">ì™¸</span>'}
        </span>
        <span>${r.time}</span>
      </div>
    `).join('');
  }

  // í•™ë…„/ë°˜ ë³€ê²½ ì‹œ ì´ë¦„ ì˜µì…˜ ê°±ì‹ 
  function updateNameOptions() {
    const grade = document.getElementById('grade').value;
    const classNum = document.getElementById('class').value;
    const nameSelect = document.getElementById('name');

    nameSelect.innerHTML = '<option value="">ì´ë¦„ì„ ì„ íƒí•˜ì„¸ìš”</option>';
    if (grade && classNum) {
      const key = `${grade}-${classNum}`;
      const names = studentList[key] || [];
      names.forEach(n => {
        const opt = document.createElement('option');
        opt.value = n;
        opt.textContent = n;
        nameSelect.appendChild(opt);
      });
    }
  }

  // ===== ë™ì‘ =====
  function registerStudent() {
    const grade = document.getElementById('grade').value.trim();
    const classNum = document.getElementById('class').value.trim();
    const name = document.getElementById('name').value.trim();
    if (!grade || !classNum || !name) {
      alert('í•™ë…„, ë°˜, ì´ë¦„ì„ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”!');
      return;
    }
    currentStudent = { grade, class: classNum, name };

    // í¼ ìˆ¨ê¸°ê³  ì¹´ë©”ë¼ ì„¹ì…˜ í‘œì‹œ
    document.getElementById('registration-form').style.display = 'none';
    document.getElementById('camera-section').style.display = 'flex';
    document.getElementById('student-info').style.display = 'block';

    document.getElementById('student-display').textContent =
      `${currentStudent.grade}í•™ë…„ ${currentStudent.class}ë°˜ ${currentStudent.name}`;
    updateCurrentTime();
  }

  function openAR() {
    window.open(
      'https://www.apoc.day/content/95db481c-d487-46b4-b0f1-a1aa6b484eb7',
      '_blank',
      'noopener'
    );
  }

  // ===== (REPLACE) ê¸°ì¡´ takePhotoë¥¼ ì´ ë²„ì „ìœ¼ë¡œ êµì²´ =====
  function takePhoto() {
    const now = new Date();
    if (!isWithinLunch(now)) {
      const proceed = confirm('ì§€ê¸ˆì€ ì ì‹¬ì‹œê°„ì´ ì•„ë‹™ë‹ˆë‹¤. ê·¸ë˜ë„ ì¸ì¦ì„ ê¸°ë¡í• ê¹Œìš”?');
      if (!proceed) return;
    }
    const record = {
      ...currentStudent,
      timestamp: now.toISOString(),
      date: now.toLocaleDateString('ko-KR'),
      time: now.toLocaleTimeString('ko-KR'),
      lunchWindow: isWithinLunch(now) ? 'Y' : 'N'
    };

    // (1) ë¡œì»¬ ì €ì¥
    brushingRecords.push(record);
    saveRecords();

    // (2) ì‹œíŠ¸2ë¡œ ì „ì†¡
    // Apps Script ì›¹ì•± ì½”ë“œê°€ ì‹œíŠ¸2ì— [ë‚ ì§œ,ì‹œê°„,í•™ë…„,ë°˜,ì´ë¦„,ì ì‹¬ì—¬ë¶€,timestamp]ë¡œ appendRow í•˜ë„ë¡ ë˜ì–´ìˆë‹¤ëŠ” ì „ì œ
    sendToSheet2({
      date: record.date,
      time: record.time,
      grade: record.grade,
      class: record.class,
      name: record.name,
      lunchWindow: record.lunchWindow,
      timestamp: record.timestamp
    });

    // UI ì—…ë°ì´íŠ¸
    document.getElementById('success-message').style.display = 'block';
    document.getElementById('records-section').style.display = 'block';
    updateRecordsList();

    setTimeout(() => { goBack(); }, 2800);
  }

  function goBack() {
    document.getElementById('camera-section').style.display = 'none';
    document.getElementById('success-message').style.display = 'none';

    document.getElementById('registration-form').style.display = 'block';
    document.getElementById('grade').value = '';
    document.getElementById('class').value = '';
    document.getElementById('name').innerHTML = '<option value="">ì´ë¦„ì„ ì„ íƒí•˜ì„¸ìš”</option>';

    currentStudent = null;
  }

  function exportToExcel() {
    if (brushingRecords.length === 0) {
      alert('ë‚´ë³´ë‚¼ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.');
      return;
    }
    let csvContent = "ë‚ ì§œ,ì‹œê°„,í•™ë…„,ë°˜,ì´ë¦„,ì ì‹¬ì‹œê°„ì—¬ë¶€\n";
    brushingRecords.forEach(r => {
      csvContent += `${r.date},${r.time},${r.grade}í•™ë…„,${r.class}ë°˜,${r.name},${r.lunchWindow || ''}\n`;
    });
    const blob = new Blob(["\uFEFF" + csvContent], { type:'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = `ì–‘ì¹˜ê¸°ë¡_${new Date().toISOString().slice(0,10)}.csv`;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
  }

  // ì´ë²¤íŠ¸ ë°”ì¸ë”©
  document.getElementById('grade').addEventListener('change', updateNameOptions);
  document.getElementById('class').addEventListener('change', updateNameOptions);
  document.getElementById('register-btn').addEventListener('click', registerStudent);
  document.getElementById('open-ar-btn').addEventListener('click', openAR);
  document.getElementById('complete-btn').addEventListener('click', takePhoto);
  document.getElementById('back-btn').addEventListener('click', goBack);
  document.getElementById('export-btn').addEventListener('click', exportToExcel);

  // ì´ˆê¸° ë¡œë“œ
  window.addEventListener('load', () => {
    if (brushingRecords.length > 0) {
      document.getElementById('records-section').style.display = 'block';
      updateRecordsList();
    }
  });
</script>

 
</body>
</html>
